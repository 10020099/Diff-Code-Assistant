# Diff Code Assistant

**Diff Code Assistant** 是一个强大的桌面工具，旨在利用大型语言模型（LLM）的能力，简化大规模代码重构和修改流程。

通过直观的图形界面，您可以轻松选择项目文件、生成上下文，并与LLM协作进行精确的代码修改。

## ✨ 版本说明

本项目提供两个版本：

- **原版本** (`main.py`) - 简单稳定的基础版本
- **增强版** (`main_enhanced.py`) - 功能丰富的优化版本 **（推荐）**

## 🚀 增强版新功能

### 界面优化
- **现代化设计**: 基于CustomTkinter的美观界面
- **智能文件树**: 支持搜索、过滤、批量选择
- **实时统计**: 显示项目规模、文件类型分布
- **彩色Diff预览**: 更好的差异可视化

### 性能提升
- **异步处理**: 后台扫描文件，界面不卡顿
- **智能过滤**: 自动排除大文件和二进制文件
- **内存优化**: 支持更大规模的项目

### 功能增强
- **文件类型识别**: 支持30+种编程语言
- **Diff验证**: 智能检查diff格式正确性
- **直接应用Diff**: 🆕 自动解析并应用diff修改，无需手动操作
- **智能备份**: 🆕 自动创建文件备份，支持一键回滚
- **预览模式**: 🆕 安全预览修改内容，不实际修改文件
- **进度指示**: 长时间操作显示详细进度
- **错误处理**: 完善的异常处理机制

## 📥 安装

### 系统要求
- Python 3.8+
- Windows、macOS 或 Linux

### 安装步骤

1. **克隆仓库**:
   ```bash
   git clone https://github.com/10020099/Diff-Code-Assistant.git
   cd Diff-Code-Assistant
   ```

2. **安装依赖**:
   ```bash
   pip install -r requirements.txt
   ```

## 🎯 使用方法

### 启动应用

**推荐使用增强版**:
```bash
python main_enhanced.py
```

**或使用原版本**:
```bash
python main.py
```

### 四步工作流程

#### 1️⃣ 项目设置
- 选择项目根目录
- 设置文件大小限制
- 扫描并选择相关文件
- 查看项目统计信息

#### 2️⃣ 上下文生成
- 输入修改指令
- 生成完整的LLM提示
- 复制到剪贴板

#### 3️⃣ Diff预览
- 粘贴LLM返回的diff
- 验证格式正确性
- 彩色预览修改内容

#### 4️⃣ 代码应用
**方式1 (推荐): 直接应用**
- 🚀 一键自动应用diff修改
- 📋 预览修改内容和影响文件
- 💾 自动创建备份文件
- ↩️ 支持一键回滚操作

**方式2 (传统): 手动应用**
- 生成应用提示
- 获取完整的修改后代码
- 手动应用到项目

## 🎯 新功能亮点

### 🚀 直接应用Diff (新手友好)
不再需要手动复制粘贴代码！增强版现在支持：

1. **一键应用**: 直接解析diff并自动修改文件
2. **安全预览**: 预览模式让您先看到会发生什么变化
3. **智能备份**: 自动备份原文件，出错可一键回滚
4. **详细验证**: 智能检查diff格式和文件冲突

### 📋 使用步骤
1. 在"Diff预览"选项卡粘贴LLM返回的diff
2. 点击"预览Diff"检查修改内容
3. 切换到"代码应用"选项卡
4. 选择"创建备份文件"（推荐）
5. 点击"🚀 直接应用Diff"
6. 确认修改并等待完成

## 💡 使用场景

### 代码重构
- 批量重命名类、函数、变量
- 重组代码结构
- 应用设计模式

### 功能开发
- 为多个文件添加相同功能
- API版本升级迁移
- 跨文件的一致性修改

### 代码标准化
- 统一代码风格
- 添加类型注解
- 完善文档注释

## 🔧 配置说明

### 支持的文件类型
- **编程语言**: Python、JavaScript、TypeScript、Java、C++、C#、Go、Rust等
- **标记语言**: HTML、XML、Markdown、YAML
- **配置文件**: JSON、YAML、SQL等
- **脚本文件**: Shell、Batch、PowerShell

### 自动排除的文件
- 编译产物: `*.pyc`、`__pycache__`、`node_modules`
- 版本控制: `.git`、`.svn`
- IDE文件: `.vscode`、`.idea`
- 日志和临时文件: `*.log`、`*.tmp`

## 🆚 版本对比

| 功能 | 原版本 | 增强版 |
|------|--------|--------|
| 基础功能 | ✅ | ✅ |
| 现代化界面 | ❌ | ✅ |
| 智能文件过滤 | ❌ | ✅ |
| 异步处理 | ❌ | ✅ |
| 项目统计 | ❌ | ✅ |
| Diff验证 | ❌ | ✅ |
| **直接应用Diff** | ❌ | ✅ |
| **智能备份回滚** | ❌ | ✅ |
| **预览模式** | ❌ | ✅ |
| 进度显示 | ❌ | ✅ |

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

本项目采用 MIT 许可证。详见 [LICENSE](LICENSE) 文件。

---

**开始您的高效代码重构之旅！** 🎉
